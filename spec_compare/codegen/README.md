# corepc-codegen

Code generation tool for Bitcoin Core JSON-RPC API types from OpenRPC specification.

## Overview

This tool reads an OpenRPC JSON document (as generated by Bitcoin Core v30+) and generates
Rust type definitions that can be used with the `corepc-types` crate.

The custom downstream patch `bitcoin-cli getopenrpc` command outputs an OpenRPC document that describes all available RPC methods and their input/output schemas.

## Usage

### Generate types for a specific version

```bash
cargo run -- --input ../OpenRPC.json --output .. --core-version 30 --single-file
```

### Command-line option

- `-i, --input <PATH>`: Path to the OpenRPC.json file
- `-o, --output <PATH>`: Output directory for generated files
- `-c, --core-version <VERSION>`: Bitcoin Core version (e.g., "v30")
- `--dry-run`: Only print what would be generated, don't write files
- `--single-file`: Generate a single combined file instead of separate modules

## Output Structure

The generator produces:

- One `.rs` file per RPC category (blockchain, wallet, mining, etc.)
- A `mod.rs` file that re-exports all types

## Integration with Existing Types

The generated types are meant to supplement, not replace, the manually maintained types
in `corepc-types`. The workflow is:

1. Generate types from OpenRPC.json
2. Compare with existing types to find discrepancies
3. Update the manual types as needed
4. Add `into_model()` conversions where appropriate

## How It Works

1. **Parses OpenRPC.json** - Reads the OpenRPC document structure
2. **Groups by category** - Methods are grouped by their `x-bitcoin-category`
3. **Generates Rust types** - Creates structs with proper:
   - `#[derive(Clone, Debug, PartialEq, Deserialize, Serialize)]`
   - `#[serde(rename = "...")]` for fields that need it
   - `Option<T>` for optional fields
   - Nested types for complex objects
   - `BTreeMap<String, T>` for dynamic objects

## Word Splitting

Since Bitcoin Core method names are all-lowercase (e.g., `getblockchaininfo`), the
generator uses a dictionary of known words to properly split them into PascalCase
struct names (`GetBlockchainInfo`) and snake_case field names.

## Limitations

- Model types with `rust-bitcoin` conversions must still be written manually
- Some complex union types fall back to `serde_json::Value`
- Parameter types are not currently generated
